const fs = require("fs");
const path = __dirname + "/cache/war.json";

// ржПржЦрж╛ржирзЗ рждрзЛржорж╛рж░ рзйржЯрж╛ UID ржжрж╛ржУ
const ADMIN_UIDS = ["61577359509594", "661558166309783", "100027116303378"];

module.exports = {
  config: {
    name: "war",
    version: "1.2",
    author: "Amit Max + Asif",
    description: "Tag someone to war-mode and insult them automatically when they chat",
    category: "fun",
    usages: "[on/off @tag]",
    cooldowns: 5,
    role: 0,
  },

  onStart: async function({ api, event, args }) {
    const { threadID, messageID, mentions } = event;

    // рж╢рзБржзрзБржорж╛рждрзНрж░ ADMIN_UIDS ржЗржЙржЬрж╛рж░ ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░ржмрзЗ
    if (!ADMIN_UIDS.includes(event.senderID)) {
      return api.sendMessage(
        "- рждрзБржЗ ржХрзЛржи ржмрж╛рж▓, рждрж░ ржХржерж╛рзЯ ржЧрж╛рж▓рж┐ ржжрж┐ржм..!ЁЯЩД",
        threadID,
        messageID
      );
    }

    if (!fs.existsSync(path)) fs.writeFileSync(path, "[]", "utf-8");
    let warList;
    try {
      warList = JSON.parse(fs.readFileSync(path, "utf-8"));
    } catch {
      warList = [];
    }

    if (!args.length) {
      return api.sendMessage(
        `тЪая╕П Usage:\n.war on @user - war ржорзЛржб ржЪрж╛рж▓рзБ ржХрж░ржмрзЗ\n.war off @user - war ржорзЛржб ржмржирзНржз ржХрж░ржмрзЗ`,
        threadID,
        messageID
      );
    }

    const command = args[0].toLowerCase();

    if (command !== "on" && command !== "off") {
      return api.sendMessage(
        `тЪая╕П Usage:\n.war on @user - war ржорзЛржб ржЪрж╛рж▓рзБ ржХрж░ржмрзЗ\n.war off @user - war ржорзЛржб ржмржирзНржз ржХрж░ржмрзЗ`,
        threadID,
        messageID
      );
    }

    if (!mentions || Object.keys(mentions).length === 0) {
      return api.sendMessage(
        `-  ржЖржмрж╛рж▓ ржЬрж╛ржд ржПрж░ ржорж╛рж░рзЗ ржЪрзБржжрж┐ ржорзЗржирж╢ржи ржжрзЗ..!ЁЯдм`,
        threadID,
        messageID
      );
    }

    const mentionID = Object.keys(mentions)[0];

    if (command === "on") {
      const exists = warList.some(
        e => e.threadID === threadID && e.userID === mentionID
      );

      if (exists) {
        return api.sendMessage(
          `ЁЯШТ ${mentions[mentionID].replace("@", "")} ржУрж░рзЗ ржЖржЧрзЗржЗ ржПржб ржХрж░рзЗ рж░рж╛ржЦржЫрж┐`,
          threadID,
          messageID
        );
      }

      warList.push({ threadID, userID: mentionID });
      fs.writeFileSync(path, JSON.stringify(warList, null, 2), "utf-8");

      return api.sendMessage(
        `тЪФя╕П ${mentions[mentionID].replace("@", "")} рзйрзпрзж┬░ рждрж╛ржкржорж╛рждрзНрж░рж╛рзЯ рждрж░ ржорж╛рж░рзЗ ржЪрзБржжрж┐ ржорзЗрж╕рзЗржЬ ржжрзЗ..!`,
        threadID,
        messageID
      );
    }

    if (command === "off") {
      const updatedList = warList.filter(
        e => !(e.threadID === threadID && e.userID === mentionID)
      );

      fs.writeFileSync(path, JSON.stringify(updatedList, null, 2), "utf-8");

      return api.sendMessage(
        `ЁЯе▒ ${mentions[mentionID].replace("@", "")} ржпрж╛ ржХрж╛ржиржХрж┐рж░ ржкрзЛрж▓рж╛ ржорж╛ржл ржХрж░рзЗ ржжрж┐рж▓рж╛ржо..!`,
        threadID,
        messageID
      );
    }
  },

  onChat: async function({ api, event }) {
    if (!event.isGroup) return;

    if (!fs.existsSync(path)) return;

    let warList;
    try {
      warList = JSON.parse(fs.readFileSync(path, "utf-8"));
    } catch {
      warList = [];
    }

    const isWar = warList.some(
      e => e.threadID === event.threadID && e.userID === event.senderID
    );

    if (!isWar) return;

    const insults = [
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржнрзЛржБржжрж╛рж░ ржнрзЗрждрж░ ржерзЗржХрзЗ ржПрждрзЛ ржЧржирзНржз ржЖрж╕рзЗ, ржЫрзБржБржпрж╝рзЗ ржжрзЗржЦрж▓рзЗ рж╣рж╛ржд ржкрзБржбрж╝рзЗ ржпрж╛ржпрж╝!",
      "рждрзЛрж░ ржмрж╛ржкрзЗрж░ ржарж╛ржЯрзНржЯрж╛ ржерзЗржХрзЗржЗ рждрзБржЗ ржЬржирзНржорзЗржЫрж┐рж╕, ржЧрзБржжрзЗ ржорж╛рж▓ ржкржбрж╝рж╛рж░ ржнрзБрж▓рзЗржЗ рждрзБржЗ ржПрж╕рзЗржЫрж┐рж╕!",
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржнрзЛржжрж╛ ржпрзЗржи рж░рж┐ржХрж╢рж╛рж░ ржЪрж╛ржХрж╛ тАУ рж╕ржм ржкрзНржпрж╛рж╕рзЗржЮрзНржЬрж╛рж░ ржпрж╛ржпрж╝ ржЖрж╕рзЗ!",
      "рждрзБржЗ ржПржоржи ржЪрзБржжржиржЦрзЛрж░, рждрзЛржХрзЗ ржЪрзБржжрзЗ ржЧрж░рзБ ржкрж░рзНржпржирзНржд рж╣рж╛ржБржкрж╛ржпрж╝!",
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржжрзБржз ржЦрзЗрждрзЗ ржЦрзЗрждрзЗ рждрзЛржХрзЗ ржЪрзБрж╖рзЗ ржлрзЗрж▓ржЫрж┐рж▓рж╛ржо!",
      "рждрзЛрж░ ржнрзЛржжрж╛ ржПржоржи ржврж┐рж▓рж╛, ржврзБржХрж▓рзЗ ржЖржУржпрж╝рж╛ржЬ рж╣ржпрж╝ ржирж╛!",
      "рждрзБржЗ рждрзЛрж░ ржмрж╛ржмрж╛рж░ ржнрзЗржЬрж╛ ржХржиржбржо, ржорж╛ржпрж╝рзЗрж░ ржнрзЛржжрж╛ ржерзЗржХрзЗ ржлрж╕ржХрзЗ ржЬржирзНржорзЗржЫрж┐рж╕!",
      "рждрзЛрж░ ржмрзЛржирзЗрж░ ржЧрзБржжрзЗ ржЧрзБржЧрж▓ ржорзНржпрж╛ржкржУ ржкрже ржЦрзБржБржЬрзЗ ржкрж╛ржпрж╝ ржирж╛!",
      "рждрзБржЗ ржПржоржи ржЪрзЛржжрж╛ржирзНржжрж╛, рждрзЛржХрзЗ ржжрзЗржЦрж▓рзЗржЗ ржХрзБрждрзНрждрж╛рж░рж╛ржУ ржорж╛рж▓ ржлрзЗрж▓рждрзЗ ржЪрж╛ржпрж╝!",
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржкрзЗржЫржирзЗ ржкрзЗржЫржирзЗ ржЪрзБржжрж┐, ржЖрж░ рждрзБржЗ рж╕рж╛ржоржирзЗ ржжрж╛ржБржбрж╝рж┐ржпрж╝рзЗ рж╣рж╛ржд ржорж╛рж░рж┐рж╕!",
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржЧрзБржжрзЗ ржЖржЧрзБржи рж▓рж╛ржЧрж╛ржЗржЫрж┐рж▓рж╛ржо, ржПржЦржи ржзрзЛржБржпрж╝рж╛рждрзЗ рждрзБржЗ рж╣рж╛ржБржкрж╛ржЪрзНржЫрж┐рж╕!",
      "рждрзЛрж░ ржмрзЛржирзЗрж░ ржЧрзБржжрзЗ ржПржд ржЯрзНрж░рж╛ржлрж┐ржХ, ржкрзБрж▓рж┐рж╢ ржкрж░рзНржпржирзНржд рж▓рж╕рзНржЯ рж╣ржпрж╝!",
      "рждрзЛрж░ ржЬржирзНржоржЯрж╛ рж╣ржпрж╝рзЗржЫрж┐рж▓рзЛ ржПржХ ржХрзБржХрзБрж░рзЗрж░ ржЧрзБржжрзЗ тАУ ржнрзБрж▓рзЗ ржорж╛ржирзБрж╖ рж╣рж▓рж┐!",
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржжрзБржзрзЗ ржмрж┐рж╖ ржЫрж┐рж▓рзЛ, рждрж╛ржЗ рждрзБржЗ ржПржд ржмрж┐рж╖рж╛ржХрзНржд!",
      "рждрзБржЗ ржПржоржи ржмрзЗржХрж╛рж░ ржЪрзБржжрж┐, ржорж╛рж▓ ржлрзЗрж▓рж╛рж░ ржЖржЧрзЗржЗ ржмрзНржпрж╛ржЯрж╛рж░рж┐ рж╢рзЗрж╖!",
      "рждрзЛрж░ ржорж╛ ржпржЦржи ржХрзБрждрзНрждрж╛рж░ рж╕рж╛ржерзЗ ржХрж░ржЫрж┐рж▓, рждрзБржЗ ржкрж╛рж╢рзЗржЗ рж╣рж╛ржд ржорж╛рж░ржЫрж┐рж▓рж┐!",
      "рждрзЛрж░ ржмрзЛржиржХрзЗ ржПржоржи ржЪрзБржжрзЗржЫрж┐, ржнрзЛржжрж╛ ржПржЦржи ржмрж╛ржЗржкрж╛рж╕ рж░рж╛рж╕рзНрждрж╛!",
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржЧрзБржжрзЗ рж╣рж╛рж░рж┐ржХрзЗржи ржврзБржХрж┐ржпрж╝рзЗ ржЖрж▓рзЛ ржЬрзНржмрж╛рж▓рж╛ржЗ!",
      "рждрзЛрж░ ржмрж╛ржкрзЗрж░ ржзрзЛржи ржнрж╛ржЩрзНржЧрж╛ тАУ рждрзБржЗ ржЬржирзНржорзЗржЫрж┐рж╕ ржнрзБрж▓рзЗ!",
      "рждрзБржЗ рж╕рзЗржЗ ржЧрзБржж, ржпрзЗржЯрж╛ ржЪрзЛржжрж╛рж░ ржкрж░рзЗржУ ржзрзЛржи ржХрж╛ржБржжрзЗ!",
      "рждрзЛрж░ ржмрзЛржирзЗрж░ ржЧрзБржжрзЗ рж╣рзЗрж▓рж┐ржХржкрзНржЯрж╛рж░ржУ ржЙржбрж╝рзЗ!",
      "рждрзЛрж░ ржорж╛ ржЧрзБржж ржжрзЗржЦрж┐ржпрж╝рзЗ ржкржпрж╝рж╕рж╛ ржЦрж╛ржпрж╝, рждрзБржЗ рж╕рзЗржЯрж╛рж░ ржжрж╛рж▓рж╛рж▓!",
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржжрзБржзрзЗрж░ ржжрзЛржХрж╛ржи ржЦрзБрж▓ржм, ржирж╛ржо рж╣ржмрзЗ 'ржЪрзБрж╖рждрзЗ ржЖрж╕рзЛ ржЗржиржХрж╛ржо ржирж╛ржУ'!",
      "рждрзЛрж░ ржорж╛ ржЖржорж╛ржХрзЗ ржЪрзЛржжрж╛ ржЫрж╛ржбрж╝рж╛ ржШрзБржорж╛рждрзЗ ржкрж╛рж░рзЗ ржирж╛!",
      "рждрзЛрж░ ржмрзЛржирзЗрж░ ржЧрзБржжрзЗ ржврзБржХрждрзЗ ржЧрж┐ржпрж╝рзЗ GPS ржмржирзНржз рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝!",
      "рждрзЛрж░ ржорж╛ ржЪрзБржжрж┐ ржЖрж░ рждрзБржЗ ржорж┐ржЫрзЗржорж┐ржЫрж┐ ржнрж╛ржЗ ржмрж▓рж┐рж╕!",
      "рждрзЛрж░ ржЬржирзНржо ржЧрзБржжрзЗ ржзрзЛржи ржирж╛ ржврзЛржХрж╛ржирзЛ ржПржХ ржнрзБрж▓рзЗрж░ ржлрж▓!",
      "рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржЧрзБржжрзЗ ржлрзНржпрж╛ржи ржЪрж╛рж▓рж╛ржЗ тАУ ржЧрж░ржо рж▓рж╛ржЧрзЗ ржЪрзБржжрждрзЗ!",
      "рждрзЛрж░ ржмрзЛржи ржЪрзБржжрждрзЗ ржПржд ржоржЬрж╛, ржнрзЛржжрж╛ ржпрзЗржи ржкрж╛ржорзНржкрж╛рж░рзЗрж░ ржмрж╛рж▓рж┐рж╢!",
      "рждрзЛрж░ ржорж╛ ржЖржорж╛рж░ рж╣рзЛржЯрзЗрж▓рзЗрж░ ржлрзНрж░рзА ржЖржЗржЯрзЗржо тАУ ржЪрж╛ржЗрж▓рзЗ ржЪрзБржжрзЗ ржирзЗ!",
      "рждрзБржЗ рждрзЛрж░ ржорж╛ржпрж╝рзЗрж░ ржжрзБржз ржЦрзЗрждрзЗ ржЦрзЗрждрзЗ ржПржЦржирзЛ ржжрж╛ржБржд ржЧржЬрж╛ржпрж╝ржирж┐!"
    ];

    const insult = insults[Math.floor(Math.random() * insults.length)];

    // ржЧрж╛рж▓рж┐ рж░рж┐ржкрзНрж▓рж╛ржЗ рж╣рж┐рж╕рзЗржмрзЗ ржкрж╛ржарж╛ржмрзЗ
    return api.sendMessage(insult, event.threadID, event.messageID);
  }
};
